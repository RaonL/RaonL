- ğŸ‘‹ Hi, Iâ€™m @RaonL
- ğŸ‘€ Iâ€™m interested in ...
- ğŸŒ± Iâ€™m currently learning ...
- ğŸ’ï¸ Iâ€™m looking to collaborate on ...
- ğŸ“« How to reach me ...

port json
import requests, sys, base64, collections
import urllib3
import csv
import getpass

from credential import *




urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)


#NITRO_SERVER=input("Server IP: ")

#NITRO_USER=input("Username: ")

#NITRO_PWD = input("pw: ")

NITRO_SERVER= "10.10.11.221"

NITRO_USER= "nsroot"

NITRO_PWD = "N@mu70331"
#USERNAME = "nsroot"
#PASSWORD = "N@mu70331"
#NS_IP = "10.10.10.140"


#.csv íŒŒì¼ì„ ì—´ê³  ìƒˆ ì¤„ì„ ë§Œë“­ë‹ˆë‹¤.
with open('monitor_status.csv','w', newline='') as f:
    writer = csv.writer(f)

    # ê° ì—´ì— ì œëª© ì“°ê¸°
    writer.writerow(['vServer Name','Service Name', 'Server Name', 'Port', 'Monitor Name', 'HTTP Request', 'LB VIP Status', 'Server Status', 'Backend Server State'])

    # ë¡œë“œ ë°¸ëŸ°ì‹± vServers ëª©ë¡ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ NITRO APIì— ì²« ë²ˆì§¸ ìš”ì²­
    lbvs_response=requests.get("http://%s/nitro/v1/config/lbvserver"%(NITRO_SERVER),auth=(NITRO_USER, NITRO_PWD),verify=False)
    
    lbvs_data=json.loads(lbvs_response.text)
    
    # lbvs_dataì˜ ê° lbvserverì— ëŒ€í•´ ì´ë¦„ê³¼ í˜„ì¬ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ê¸°
    for j in lbvs_data['lbvserver']:
        lbvs_name=j['name']
        lbvs_stat=j['curstate']

        # ê° ë¶€í•˜ ë¶„ì‚° vServerì— ëŒ€í•œ ì„œë¹„ìŠ¤ ê·¸ë£¹ ë°”ì¸ë”©ì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ìš”ì²­ ë³´ë‚´ê¸°
        svg_response=requests.get("http://%s/nitro/v1/config/lbvserver_service_binding/%s"%(NITRO_SERVER,lbvs_name),auth=(NITRO_USER, NITRO_PWD),verify=False)

        svg_data = json.loads(svg_response.text)

        #ì„œë¹„ìŠ¤ ê·¸ë£¹ ë°”ì¸ë”©ì´ ìˆëŠ” ê²½ìš° ëª¨ë‹ˆí„° ì´ë¦„ê³¼ ì„œë¹„ìŠ¤ ê·¸ë£¹ êµ¬ì„±ì›ì„ ê°€ì ¸ì˜¤ê¸°
        if 'lbvserver_service_binding' in svg_data:
            for k in svg_data['lbvserver_service_binding']:

                svg_grpname=k["servicename"]
                svgmon_response=requests.get("http://%s/nitro/v1/config/service_lbmonitor_binding/%s"%(NITRO_SERVER,svg_grpname),auth=(NITRO_USER, NITRO_PWD),verify=False)
                svgmon_data=json.loads(svgmon_response.text)


            #ëª¨ë‹ˆí„° ë°”ìš´ë“œê°€ ìˆëŠ” ê²½ìš° í¬íŠ¸, ë°±ì—”ë“œ ì„œë²„ ì´ë¦„ ë° ë°±ì—”ë“œ ì„œë²„ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ê¸°


                    # ê° ëª¨ë‹ˆí„°ì— ëŒ€í•´ ëª¨ë‹ˆí„° ì´ë¦„ì„ ê°€ì ¸
                for m in svgmon_data['service_lbmonitor_binding']:

                        monname=m["monitor_name"]
                        mon_response=requests.get("http://%s/nitro/v1/config/lbmonitor/%s"%(NITRO_SERVER,monname),auth=(NITRO_USER, NITRO_PWD),verify=False)
                        mon_data=json.loads(mon_response.text)

                        for n in mon_data["lbmonitor"]:

                            # http ìš”ì²­ í•„ë“œê°€ ìˆëŠ” ê²½ìš°
                            if 'httprequest' in mon_data["lbmonitor"][0]:

                                httpreq=n['httprequest']
                                mon_sec=n['secure']
                                httpreq=str.replace(httpreq,'GET ','')

                                if( mon_sec == 'NO'):
                                    #create test uri
                                    test_uri='http://'+svrip+svrport+httpreq
                                    response = requests.get(test_uri)

                                    if(response == 200):
                                        backend = 'UP'
                                        writer.writerow([lbvs_name,svg_grpname,svrname,port,monname,httpreq,lbvs_stat,svrstate,backend])
                                    else:
                                        backend = 'DOWN'
                                        writer.writerow([lbvs_name,svg_grpname,svrname,port,monname,httpreq,lbvs_stat,svrstate,backend])
                                else:
                                    test_uri='http://'+svrip+svrport+httpreq
                                    response = requests.get(test_uri)

                                    if(response == 200):
                                        backend = 'UP'
                                        writer.writerow([lbvs_name,svg_grpname,svrname,port,monname,httpreq,lbvs_stat,svrstate,backend])
                                    else:
                                        backend = 'DOWN'
                                        writer.writerow([lbvs_name,svg_grpname,svrname,port,monname,httpreq,lbvs_stat,svrstate,backend])
                                    


                            #else httpreqë¥¼ ì—†ìŒì— í• ë‹¹
                            else:

                                httpreq='N/A'
                                backend='N/A'
                                #write to .csv file
                                writer.writerow([lbvs_name,svg_grpname,svrname,port,monname,httpreq,lbvs_stat,svrstate,backend])

            else:

                monname='tcp'
                httpreq='N/A'
                backend='N/A'



        else:
            port ='N/A'
            svrname='N/A'
            httpreq='N/A'
            svg_grpname='N/A'
            monname='N/A'
            svrstate='N/A'
            backend='N/A'
            writer.writerow([lbvs_name,svg_grpname,svrname,port,monname,httpreq,lbvs_stat,svrstate,backend])
